# 全局事件总线

利用 Vue 构造函数的原型（Vue.prototype）作为全局事件载体，依托 Vue 实例自带的 `$on`（监听）、`$emit`（触发）、`$off`（移除）方法实现跨组件通信

## 核心步骤

### 初始化全局事件总线

在入口文件中给 Vue 原型挂载一个 Vue 实例，作为全局事件中心：

```js
//main.js
import Vue from "vue";
import App from "./App.vue";

Vue.config.productionTip = false;

//关键：给Vue原型挂载$bus,本质是一个空Vue实例
new Vue({
  render: (h) => h(App),
  //安装全局事件总线
  beforeCreate() {
    Vue.prototype.$bus = this;
  }
}).$mount("#app");
```

### 组件A（订阅者）：监听事件

需要接收数据的组件，在 mounted 中订阅事件，beforeDestroy 中移除监听（避免内存泄漏）

```js
<!-- 组件A：订阅事件（接收数据） -->
<template>
  <div>组件A接收的消息：{{ msg }}</div>
</template>

<script>
export default {
  data() {
    return {
      msg: ''
    }
  },
  mounted() {
    // 订阅事件：事件名自定义，回调函数接收参数
    this.$bus.$on('send-msg', (data) => {
      this.msg = data
      console.log('组件A收到：', data)
    })
  },
  beforeDestroy() {
    // 关键：组件销毁时移除监听，避免内存泄漏
    this.$bus.$off('send-msg')
  }
}
</script>
```

### 组件B（发布者）：触发事件

需要发送数据的组件，通过 `this.$bus.$emit` 触发订阅的事件，可传递任意参数

```js
<!-- 组件B：发布事件（发送数据） -->
<template>
  <button @click="sendToA">给组件A发消息</button>
</template>

<script>
export default {
  methods: {
    sendToA() {
      // 触发事件：事件名必须与订阅者一致，后面跟要传递的参数
      this.$bus.$emit('send-msg', 'Hello Vue2 全局事件总线！')
      // 支持多参数：this.$bus.$emit('send-msg', param1, param2)
    }
  }
}
</script>
```